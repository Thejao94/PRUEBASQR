<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Esc√°ner QR con Telegram</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <h2>Escanea un QR</h2>
  <div id="reader" style="width:300px;"></div>

  <script>
    const token = "8319147777:AAHbKbbkNF4KHvl1q4MwRDf-7BURIy20taY";   // ‚ö†Ô∏è Reemplazar
    const chat_id = "-4839758866";    // ‚ö†Ô∏è Reemplazar con el ID del grupo

    function sendToTelegram(text) {
      const url = `https://api.telegram.org/bot${token}/sendMessage`;

      fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chat_id,
          text: text
        })
      })
      .then(res => res.json())
      .then(data => console.log("Enviado:", data))
      .catch(err => console.error("Error:", err));
    }

    function registrar(nombreQR) {
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        const fecha = new Date().toLocaleDateString();
        const hora = new Date().toLocaleTimeString();

        const mensaje = `üìç Registro:
Nombre: ${nombreQR}
Fecha: ${fecha}
Hora: ${hora}
Ubicaci√≥n: https://maps.google.com/?q=${lat},${lon}`;

        sendToTelegram(mensaje);
        alert("Registro enviado a Telegram ‚úÖ");
      });
    }

    function onScanSuccess(decodedText, decodedResult) {
      registrar(decodedText);
    }

    const html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      onScanSuccess
    );
  </script>
</body>
</html>
